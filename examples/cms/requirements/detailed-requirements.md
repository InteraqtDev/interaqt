# CMS 详细需求文档

## 项目背景
需要构建一套内容管理系统，让产品运营人员能够在线管理预置数据的后台操作界面。

## 核心功能需求

### 1. Style 实体管理
Style 实体是系统的核心数据模型，包含以下字段：

| 字段名 | 类型 | 填写方式 | 描述 |
|--------|------|----------|------|
| id | uuid | 自动 | 主键标识符 |
| label | text | 手动 | 前端展示用名称（如 "Manga"） |
| slug | text | 手动 | 唯一、URL-safe（如 manga），对应旧代码里的 value |
| description | text | 手动 | 详细描述信息 |
| type | varchar(32) | 手动 | 分类类型 ("animation / surreal / …") |
| thumb_key | text | 手动上传图片，自动填写 s3 key | 缩略图的存储 key |
| priority | int | 手动 | 前端排序权重，数值越大越靠前 |
| status | varchar(16) | 手动 | 状态：draft / published / offline |
| created_at | timestamptz | 自动 | 创建时间，默认 now() |
| updated_at | timestamptz | 自动 | 更新时间，自动维护 |

### 2. 排序管理
- 支持拖拽排序功能
- 通过 priority 字段控制显示顺序
- 拖拽操作应自动更新相关记录的 priority 值

### 3. 版本管理
- 支持发布版本管理
- 支持版本回滚功能
- 每次发布操作创建一个版本快照
- 可以回滚到任意历史版本

### 4. 状态管理
Style 记录有三种状态：
- **draft**: 草稿状态，仅管理员可见
- **published**: 已发布状态，前端可见
- **offline**: 下线状态，前端不可见但保留数据

### 5. 图片管理
- 支持缩略图上传
- 自动生成 S3 存储 key
- 支持图片预览功能

## 用户角色与权限

### 管理员 (Admin)
- 可以创建、编辑、删除 Style 记录
- 可以修改 Style 状态
- 可以进行排序操作
- 可以发布版本和回滚

### 运营人员 (Operator)  
- 可以创建、编辑 Style 记录
- 可以修改 draft 和 published 状态
- 可以进行排序操作
- 不能删除记录，不能直接设置 offline 状态

### 查看者 (Viewer)
- 只能查看已发布的 Style 记录
- 不能进行任何修改操作

## 业务流程

### Style 记录生命周期
1. **创建**: 管理员/运营人员创建新的 Style 记录，默认状态为 draft
2. **编辑**: 在 draft 状态下可以自由编辑所有字段
3. **发布**: 将状态改为 published，前端可见
4. **下线**: 管理员可将记录状态改为 offline
5. **删除**: 仅管理员可删除记录（物理删除）

### 版本发布流程
1. **准备发布**: 确认所有需要发布的 Style 记录状态正确
2. **创建版本**: 系统创建当前所有 published 状态记录的快照
3. **发布确认**: 版本生效，前端使用新版本数据
4. **回滚选项**: 如有问题可回滚到任意历史版本

### 排序管理流程
1. **查看列表**: 按 priority 值降序排列显示
2. **拖拽排序**: 用户拖拽改变记录顺序
3. **更新优先级**: 系统自动计算并更新受影响记录的 priority 值
4. **保存确认**: 排序结果立即生效

## 技术要求

### 数据一致性
- 所有 slug 值必须唯一
- priority 值需要保证正确的排序逻辑
- 版本快照数据完整性

### 性能要求
- Style 列表分页加载（每页 20 条）
- 图片上传支持进度显示
- 拖拽排序操作响应时间 < 300ms

### 安全要求
- 所有操作需要身份验证
- 按角色控制操作权限
- 图片上传需要格式和大小验证

## 前端界面要求

### Style 管理列表页
- 表格形式展示 Style 记录
- 支持按状态、类型筛选
- 支持按名称、创建时间搜索
- 行内操作：编辑、删除、状态切换
- 批量操作：批量修改状态、批量删除

### Style 编辑页面
- 表单界面编辑 Style 信息
- 实时预览缩略图
- 字段验证和错误提示
- 保存草稿、发布按钮

### 排序管理页面
- 可视化拖拽排序界面
- 实时显示 priority 值
- 排序操作撤销功能

### 版本管理页面
- 历史版本列表
- 版本对比功能
- 一键回滚操作
- 发布新版本按钮

## 扩展需求

### 未来可能扩展的功能
1. **多语言支持**: label 和 description 支持多语言版本
2. **审批流程**: 发布前增加审批环节
3. **操作日志**: 记录所有用户操作历史
4. **数据导入导出**: 支持批量导入/导出 Style 数据
5. **API 接口**: 提供 RESTful API 供其他系统调用