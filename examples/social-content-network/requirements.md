# 社交+内容网络详细需求

## Prompt
构建社交+内容网络
  - 好友关系实现
  - 内容发布、草稿等等功能
  - 点赞功能的实现

## 系统概述

构建一个社交内容网络平台，用户可以发布内容、建立好友关系、进行社交互动。系统需要支持内容的状态管理、社交关系管理、以及各种统计数据的实时更新。

## 功能需求

### 1. 用户系统

#### 1.1 用户实体
- **基本信息**
  - 用户名（唯一标识）
  - 显示名称
  - 头像URL
  - 个人简介
  - 注册时间
  - 最后活跃时间

- **统计信息（响应式计算）**
  - 好友数量
  - 关注者数量
  - 发布内容数量
  - 获得的总点赞数
  - 活跃度分数

#### 1.2 用户相关交互
- 更新个人资料
- 查看用户信息
- 查看用户发布的内容列表

### 2. 好友关系系统

#### 2.1 好友关系类型
- **好友关系**：双向关系，需要双方确认
- **关注关系**：单向关系，无需对方确认

#### 2.2 好友请求流程
1. 用户A向用户B发送好友请求
2. 系统创建好友请求记录（状态：待处理）
3. 用户B可以接受或拒绝请求
4. 接受：创建双向好友关系，删除请求记录
5. 拒绝：更新请求状态为已拒绝

#### 2.3 好友关系交互
- 发送好友请求
- 接受好友请求
- 拒绝好友请求
- 取消好友关系
- 关注用户
- 取消关注用户
- 查看好友列表
- 查看关注列表
- 查看粉丝列表
- 查看待处理的好友请求

#### 2.4 权限控制
- 不能向自己发送好友请求
- 不能向已经是好友的用户发送请求
- 不能重复发送未处理的好友请求
- 只有请求的接收者可以处理请求

### 3. 内容发布系统

#### 3.1 内容实体
- **基本信息**
  - 标题
  - 内容文本
  - 作者
  - 创建时间
  - 更新时间
  - 标签列表
  - 媒体附件（可选）

- **状态信息**
  - 状态：草稿/已发布/已删除
  - 可见性：公开/仅好友/私人

- **统计信息（响应式计算）**
  - 点赞数量
  - 评论数量
  - 分享数量
  - 阅读量

#### 3.2 内容状态机
```
草稿 → 已发布 → 已删除
  ↑      ↓
  ←─────┘ (重新编辑)
```

- **草稿状态**：只有作者可见，可以编辑
- **已发布状态**：按可见性设置对外展示，可以编辑或删除
- **已删除状态**：逻辑删除，不对外展示，但保留数据

#### 3.3 内容相关交互
- 创建内容草稿
- 编辑内容
- 发布内容（草稿→已发布）
- 撤回内容（已发布→草稿）
- 删除内容
- 查看内容详情
- 查看内容列表（支持各种过滤条件）

#### 3.4 内容权限控制
- 只有作者可以编辑、发布、删除自己的内容
- 内容的可见性决定谁可以查看：
  - 公开：所有用户可见
  - 仅好友：作者的好友可见
  - 私人：只有作者可见

### 4. 点赞系统

#### 4.1 点赞关系
- 用户与内容的多对多关系
- 包含点赞时间戳
- 防止重复点赞

#### 4.2 点赞交互
- 点赞内容
- 取消点赞
- 查看内容的点赞用户列表
- 查看用户点赞过的内容列表

#### 4.3 点赞统计
- 内容的总点赞数（响应式计算）
- 用户获得的总点赞数（响应式计算）
- 热门内容排行（基于点赞数）

### 5. 评论系统

#### 5.1 评论实体
- **基本信息**
  - 评论内容
  - 评论者
  - 目标内容
  - 创建时间
  - 父评论（支持嵌套评论）

- **统计信息**
  - 子评论数量
  - 点赞数量

#### 5.2 评论交互
- 发表评论
- 回复评论
- 删除评论（只能删除自己的评论）
- 评论点赞
- 查看评论列表（按时间排序）

#### 5.3 评论权限
- 根据内容的可见性决定谁可以评论
- 只有评论者可以删除自己的评论
- 内容作者可以删除自己内容下的任何评论

### 6. 动态时间线

#### 6.1 时间线类型
- **个人动态**：用户自己发布的内容
- **好友动态**：好友发布的内容
- **推荐内容**：系统推荐的热门内容

#### 6.2 推荐算法（简化版）
- 基于点赞数和评论数的热度计算
- 时间衰减因子
- 好友互动权重加成

## 技术需求

### 1. 响应式计算需求

#### 1.1 Count 计算
- 用户的好友数量
- 用户的关注者数量
- 内容的点赞数量
- 内容的评论数量
- 用户发布的内容数量

#### 1.2 WeightedSummation 计算
- 用户活跃度分数（基于发布内容、获得点赞、评论等）
- 内容热度分数（基于点赞、评论、分享等）

#### 1.3 Transform 计算
- 推荐内容列表生成
- 用户统计信息聚合
- 热门标签生成

#### 1.4 Any/Every 计算
- 检查用户是否有待处理的好友请求
- 检查用户是否对某内容点赞过

### 2. 权限控制需求

#### 2.1 基于关系的权限
- 好友关系验证
- 内容作者权限验证
- 评论者权限验证

#### 2.2 基于状态的权限
- 内容状态访问控制
- 请求状态操作控制

### 3. 过滤实体需求

#### 3.1 内容过滤
- 公开内容：已发布且公开可见的内容
- 好友内容：好友发布的内容
- 热门内容：点赞数或评论数较高的内容
- 最新内容：按发布时间排序的内容

#### 3.2 用户过滤
- 活跃用户：最近有发布内容或互动的用户
- 推荐好友：可能认识的用户

### 4. 状态机需求

#### 4.1 内容状态机
- 状态：draft, published, deleted
- 转换：publish, unpublish, delete, restore

#### 4.2 好友请求状态机
- 状态：pending, accepted, rejected
- 转换：accept, reject

## 数据模型设计

### 实体关系图

```
User ─────┐
│         │ (1:n)
│         └─→ Post
│              │
│              │ (1:n)
│              └─→ Comment
│                   │
│                   │ (n:1, 自引用)
│                   └─→ Comment (父评论)
│
User ←───(n:n)───→ User (好友关系)
│
User ←───(n:n)───→ User (关注关系)
│
User ←───(n:n)───→ Post (点赞关系)
│
User ←───(n:n)───→ Comment (评论点赞关系)
```

### 主要实体

1. **User**：用户
2. **Post**：内容/帖子
3. **Comment**：评论
4. **Friendship**：好友关系
5. **Follow**：关注关系
6. **Like**：点赞关系
7. **CommentLike**：评论点赞关系
8. **FriendRequest**：好友请求

## 测试需求

### 1. 单元测试
- 实体创建和属性验证
- 关系建立和删除
- 响应式计算准确性
- 权限控制有效性

### 2. 集成测试
- 完整的业务流程测试
- 多用户交互场景
- 并发操作测试

### 3. 性能测试
- 大量数据下的响应式计算性能
- 复杂查询的执行效率

## 扩展性考虑

### 1. 功能扩展
- 群组功能
- 私信系统
- 内容分类和搜索
- 多媒体内容支持
- 内容审核机制

### 2. 技术扩展
- 缓存策略
- 分布式部署
- 实时通知系统
- 数据分析和报表