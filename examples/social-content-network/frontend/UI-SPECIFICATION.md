# 社交内容网络 - 用户界面规划文档

## 系统概览

这是一个基于 @interaqt/runtime 响应式框架构建的社交内容网络应用，支持用户发布内容、建立好友关系、进行社交互动。系统采用响应式架构，所有数据变化都通过声明式计算自动更新。

## 核心业务能力

### 实体系统
- **User**: 用户（包含基本信息和统计数据）
- **Post**: 内容/帖子（支持状态管理：draft → published → deleted）
- **Comment**: 评论（支持嵌套回复）
- **FriendRequest**: 好友请求（支持状态：pending → accepted/rejected）
- **Tag**: 标签

### 关系系统
- **Friendship**: 双向好友关系（对称关系）
- **Follow**: 单向关注关系
- **Like**: 点赞关系（支持帖子和评论）
- **PostTag**: 帖子标签关系

### 权限系统
- 基于作者权限的内容管理
- 基于好友关系的可见性控制
- 基于状态的操作权限控制

---

## 页面架构设计

### 1. 布局组件

#### 1.1 主导航栏 (TopNavigation)
**位置**: 页面顶部
**功能**:
- Logo/应用名称
- 全局搜索框
- 用户头像和快捷菜单
- 通知中心图标（显示未读数量）

**交互**:
- 点击Logo回到首页
- 搜索支持用户和内容搜索
- 用户菜单包含：个人资料、设置、退出

#### 1.2 侧边导航 (SideNavigation)
**位置**: 页面左侧
**功能**:
- 主要导航项目
- 快捷操作入口

**导航项目**:
- 🏠 首页动态
- 👤 我的资料
- ✍️ 发布内容
- 👥 好友管理
- 🔖 我的收藏
- 📊 数据统计

#### 1.3 右侧信息栏 (RightSidebar)
**位置**: 页面右侧
**功能**:
- 推荐关注
- 热门标签
- 在线好友
- 系统公告

---

### 2. 核心页面设计

### 2.1 首页动态 (HomePage)
**路径**: `/`
**主要功能**: 展示用户关注的内容动态流

#### 布局结构
```
+--------------------------------------------------+
|                   TopNavigation                  |
+----------+---------------------------+-----------+
| Side     | 动态内容区                | Right     |
| Nav      | +---------------------+   | Sidebar   |
|          | | 发布框 (简化版)      |   |           |
|          | +---------------------+   |           |
|          | | 内容过滤Tab         |   |           |
|          | | [全部|好友|推荐]     |   |           |
|          | +---------------------+   |           |
|          | | PostCard 1          |   |           |
|          | | PostCard 2          |   |           |
|          | | PostCard 3          |   |           |
|          | | ...                 |   |           |
|          | | 加载更多            |   |           |
|          | +---------------------+   |           |
+----------+---------------------------+-----------+
```

#### 功能组件

**发布框 (QuickPostBox)**
- 简化的内容发布入口
- 包含文本框、图片上传按钮、发布按钮
- 点击展开完整发布界面

**内容过滤Tab**
- **全部**: 显示所有可见内容（公开+好友内容）
- **好友**: 只显示好友发布的内容
- **推荐**: 基于算法推荐的热门内容

**PostCard组件** - 详见内容卡片设计

#### 交互行为
- 下拉刷新获取最新内容
- 无限滚动加载更多
- 实时更新点赞、评论数量

---

### 2.2 个人资料页 (ProfilePage)
**路径**: `/profile/:userId`
**主要功能**: 展示用户信息和发布的内容

#### 布局结构
```
+--------------------------------------------------+
|                   TopNavigation                  |
+----------+---------------------------+-----------+
| Side     | 用户信息区                | Right     |
| Nav      | +---------------------+   | Sidebar   |
|          | | 头像 | 基本信息    |   |           |
|          | |      | 统计数据    |   |           |
|          | |      | 操作按钮    |   |           |
|          | +---------------------+   |           |
|          | | 内容Tab切换         |   |           |
|          | | [帖子|点赞|收藏]     |   |           |
|          | +---------------------+   |           |
|          | | 内容列表            |   |           |
|          | +---------------------+   |           |
+----------+---------------------------+-----------+
```

#### 用户信息区

**基本信息显示**
- 头像（可点击放大）
- 用户名和显示名称
- 个人简介
- 注册时间、最后活跃时间

**统计数据** (响应式计算)
- 发布帖子数量 (`postCount`)
- 好友数量 (`friendCount`)
- 获得点赞总数
- 活跃度分数 (`activityScore`)

**操作按钮** (根据访问者身份动态显示)
- **访问自己**: [编辑资料] [设置]
- **访问他人且非好友**: [发送好友请求] [关注]
- **访问他人且是好友**: [发送消息] [取消好友]
- **访问他人且已关注**: [取消关注] [发送好友请求]

#### 内容Tab切换
- **帖子**: 用户发布的所有内容（根据可见性过滤）
- **点赞**: 用户点赞过的内容
- **收藏**: 用户收藏的内容

---

### 2.3 内容发布页 (CreatePostPage)
**路径**: `/create`
**主要功能**: 完整的内容发布功能

#### 布局结构
```
+--------------------------------------------------+
|                   TopNavigation                  |
+----------+---------------------------+-----------+
| Side     | 发布表单                  | 预览区    |
| Nav      | +---------------------+   |           |
|          | | 标题输入框          |   | 实时预览  |
|          | +---------------------+   |           |
|          | | 内容编辑器          |   |           |
|          | | (支持富文本)        |   |           |
|          | +---------------------+   |           |
|          | | 标签输入            |   |           |
|          | +---------------------+   |           |
|          | | 媒体上传            |   |           |
|          | +---------------------+   |           |
|          | | 可见性设置          |   |           |
|          | | [公开|好友|私人]     |   |           |
|          | +---------------------+   |           |
|          | | [保存草稿] [发布]    |   |           |
|          | +---------------------+   |           |
+----------+---------------------------+-----------+
```

#### 功能组件

**内容编辑器**
- 支持富文本编辑（粗体、斜体、链接等）
- 支持@用户提及
- 支持#标签插入
- 字数统计显示

**标签输入**
- 自动完成已有标签
- 支持创建新标签
- 标签数量限制（如最多10个）

**媒体上传**
- 支持拖拽上传
- 支持多图片上传
- 图片压缩和预览
- 文件大小限制提示

**可见性设置**
- **公开**: 所有人可见
- **好友**: 仅好友可见
- **私人**: 仅自己可见

#### 交互行为
- 自动保存草稿（定时或内容变化时）
- 发布前验证（标题、内容非空）
- 发布成功后跳转到内容详情页

---

### 2.4 内容详情页 (PostDetailPage)
**路径**: `/post/:postId`
**主要功能**: 显示完整内容和评论互动

#### 布局结构
```
+--------------------------------------------------+
|                   TopNavigation                  |
+----------+---------------------------+-----------+
| Side     | 内容详情                  | Right     |
| Nav      | +---------------------+   | Sidebar   |
|          | | PostCard (完整版)   |   |           |
|          | +---------------------+   |           |
|          | | 评论发布框          |   |           |
|          | +---------------------+   |           |
|          | | 评论列表            |   |           |
|          | | CommentItem 1       |   |           |
|          | |   └─ Reply 1        |   |           |
|          | |   └─ Reply 2        |   |           |
|          | | CommentItem 2       |   |           |
|          | | ...                 |   |           |
|          | +---------------------+   |           |
+----------+---------------------------+-----------+
```

#### 功能组件

**完整版PostCard**
- 显示完整内容（不截断）
- 显示所有媒体附件
- 完整的标签列表
- 详细的互动统计

**评论发布框**
- 支持回复特定评论
- 支持@用户提及
- 实时字数统计

**评论列表 (CommentItem)**
- 嵌套回复显示（最多3级）
- 评论时间显示
- 点赞功能
- 回复按钮
- 删除按钮（仅评论作者可见）

#### 交互行为
- 点击回复按钮聚焦到评论框
- 评论发布后实时插入列表
- 支持评论的展开/收起（长评论）

---

### 2.5 好友管理页 (FriendsPage)
**路径**: `/friends`
**主要功能**: 管理好友关系和好友请求

#### 布局结构
```
+--------------------------------------------------+
|                   TopNavigation                  |
+----------+---------------------------+-----------+
| Side     | 好友管理                  | Right     |
| Nav      | +---------------------+   | Sidebar   |
|          | | Tab切换             |   |           |
|          | | [好友|关注|粉丝|请求] |   |           |
|          | +---------------------+   |           |
|          | | 搜索框              |   |           |
|          | +---------------------+   |           |
|          | | 用户列表            |   |           |
|          | | UserCard 1          |   |           |
|          | | UserCard 2          |   |           |
|          | | ...                 |   |           |
|          | +---------------------+   |           |
+----------+---------------------------+-----------+
```

#### Tab功能

**好友Tab**
- 显示所有好友列表
- 支持搜索好友
- 每个好友卡片显示：头像、昵称、最近动态
- 操作：[查看资料] [发送消息] [取消好友]

**关注Tab**
- 显示关注的用户列表
- 操作：[查看资料] [取消关注] [发送好友请求]

**粉丝Tab**
- 显示关注自己的用户列表
- 操作：[查看资料] [回关] [发送好友请求]

**请求Tab** (显示未读数量徽章)
- **收到的请求**: [接受] [拒绝] [查看资料]
- **发出的请求**: [撤回] [查看状态]

#### UserCard组件
```
+----------------------------------+
| [头像] 用户名             [操作按钮] |
|       个人简介                     |
|       好友数 · 内容数 · 最后活跃    |
+----------------------------------+
```

---

### 2.6 搜索结果页 (SearchPage)
**路径**: `/search?q=keyword&type=all`
**主要功能**: 搜索用户和内容

#### 布局结构
```
+--------------------------------------------------+
|                   TopNavigation                  |
+----------+---------------------------+-----------+
| Side     | 搜索结果                  | 搜索过滤  |
| Nav      | +---------------------+   |           |
|          | | 结果Tab切换         |   | 过滤选项  |
|          | | [全部|用户|内容|标签] |   |           |
|          | +---------------------+   | 时间范围  |
|          | | 搜索结果列表        |   |           |
|          | | ResultItem 1        |   | 内容类型  |
|          | | ResultItem 2        |   |           |
|          | | ...                 |   | 排序方式  |
|          | +---------------------+   |           |
+----------+---------------------------+-----------+
```

#### 搜索过滤选项
- **时间范围**: 全部、最近一周、最近一月、最近一年
- **内容类型**: 全部、仅图片、仅视频、仅文字
- **排序方式**: 相关度、时间、热度

---

### 2.7 通知中心页 (NotificationsPage)
**路径**: `/notifications`
**主要功能**: 显示各种系统通知

#### 通知类型
- **好友请求**: 新的好友请求
- **好友接受**: 好友请求被接受
- **内容互动**: 内容被点赞、评论
- **评论回复**: 评论被回复
- **提及通知**: 被其他用户@提及
- **系统通知**: 系统公告、功能更新

#### 布局结构
```
+--------------------------------------------------+
|                   TopNavigation                  |
+----------+---------------------------+-----------+
| Side     | 通知列表                  | Right     |
| Nav      | +---------------------+   | Sidebar   |
|          | | [全部已读] [过滤]    |   |           |
|          | +---------------------+   |           |
|          | | NotificationItem 1  |   |           |
|          | | NotificationItem 2  |   |           |
|          | | ...                 |   |           |
|          | +---------------------+   |           |
+----------+---------------------------+-----------+
```

---

### 2.8 设置页面 (SettingsPage)
**路径**: `/settings`
**主要功能**: 用户偏好设置

#### 设置分类
- **个人资料**: 基本信息编辑
- **隐私设置**: 内容可见性、好友请求设置
- **通知设置**: 各类通知的开关
- **数据管理**: 导出数据、删除账户

---

## 通用组件设计

### 3.1 内容卡片 (PostCard)

#### 基础版本（用于列表显示）
```
+----------------------------------------+
| [头像] 作者名     时间        [菜单]     |
+----------------------------------------+
| 标题（如果有）                          |
| 内容文本（截断显示）                     |
| [展开全文]                             |
+----------------------------------------+
| [图片/视频预览]                         |
+----------------------------------------+
| #标签1 #标签2 #标签3                   |
+----------------------------------------+
| 👍12  💬5  👁100    [❤️] [💬] [📤]    |
+----------------------------------------+
```

#### 完整版本（用于详情页）
- 显示完整内容文本
- 显示所有媒体附件
- 显示完整标签列表
- 显示详细统计信息

#### 交互功能
- **点赞**: 点击爱心图标切换点赞状态
- **评论**: 点击评论图标跳转到详情页或展开评论
- **分享**: 点击分享图标显示分享选项
- **菜单**: 根据权限显示操作（编辑、删除、举报等）

#### 状态指示
- **草稿状态**: 显示"草稿"标签，只有作者可见
- **好友可见**: 显示"仅好友"图标
- **私人内容**: 显示"私人"图标

### 3.2 用户头像组件 (Avatar)

#### 尺寸规格
- **large**: 80px (个人资料页)
- **medium**: 48px (评论、用户卡片)
- **small**: 32px (导航栏、提及)
- **tiny**: 24px (在线状态指示)

#### 功能特性
- 支持默认头像
- 支持在线状态指示（绿色圆点）
- 点击显示用户快速信息卡片
- 支持头像裁剪和上传

### 3.3 用户信息卡片 (UserInfoCard)

**触发方式**: 悬停或点击用户头像/用户名

```
+---------------------------+
| [头像] 用户名              |
|       @username           |
|       个人简介             |
| 好友数 · 内容数 · 粉丝数    |
| [查看资料] [发送好友请求]   |
+---------------------------+
```

### 3.4 标签组件 (Tag)

#### 显示样式
- 圆角矩形背景
- 固定色彩系统（根据标签内容哈希）
- 点击跳转到标签页面

#### 交互功能
- 悬停显示标签统计（使用次数、相关内容数）
- 支持标签关注功能

---

## 响应式设计

### 4.1 断点设置
- **Desktop**: ≥ 1200px (三栏布局)
- **Tablet**: 768px - 1199px (两栏布局，隐藏右侧栏)
- **Mobile**: < 768px (单栏布局，底部导航)

### 4.2 移动端适配

#### 导航适配
- 顶部导航简化为：Logo + 搜索 + 用户头像
- 侧边导航改为底部Tab导航
- 右侧信息栏通过抽屉方式访问

#### 内容适配
- PostCard适配移动端尺寸
- 图片支持滑动浏览
- 评论支持手势操作（滑动回复、点赞）

---

## 实时功能设计

### 5.1 数据实时更新

基于 @interaqt/runtime 的响应式特性，以下数据会自动实时更新：

#### 统计数据
- 点赞数量变化 (`likeCount`)
- 评论数量变化 (`commentCount`)
- 好友数量变化 (`friendCount`)
- 用户活跃度分数 (`activityScore`)
- 内容热度分数 (`hotScore`)

#### 状态变化
- 内容发布状态 (`status: draft → published`)
- 好友请求状态 (`status: pending → accepted/rejected`)
- 在线状态变化 (`lastActiveAt`)

### 5.2 通知系统

#### 实时通知
- 新好友请求通知
- 内容被点赞/评论通知
- 评论被回复通知
- 被用户@提及通知

#### 通知展示
- 顶部导航通知图标显示未读数量
- 支持桌面推送通知
- 支持声音提醒（可配置）

---

## 交互细节设计

### 6.1 加载状态

#### 骨架屏 (Skeleton)
- PostCard加载骨架
- UserCard加载骨架
- 评论列表加载骨架

#### 加载指示器
- 按钮loading状态（发布、点赞等操作）
- 页面级loading（路由切换）
- 无限滚动加载更多

### 6.2 错误处理

#### 网络错误
- 显示重试按钮
- 自动重试机制
- 离线状态提示

#### 权限错误
- 友好的权限不足提示
- 引导用户进行相应操作（如登录、发送好友请求）

#### 操作失败
- Toast提示操作结果
- 表单验证错误提示
- 乐观更新回滚

### 6.3 性能优化

#### 虚拟滚动
- 长列表使用虚拟滚动
- 图片懒加载
- 组件懒加载

#### 缓存策略
- API响应缓存
- 图片缓存
- 路由组件缓存

---

## 数据流架构

### 7.1 状态管理

基于 @interaqt/runtime 的响应式特性：

#### 实体状态
- 通过 Controller 统一管理
- 响应式计算自动更新
- 关系数据自动同步

#### 界面状态
- 使用 React State/Zustand 管理局部状态
- 全局状态使用 Context
- 表单状态使用 React Hook Form

### 7.2 API调用

#### 交互调用
```javascript
// 发布内容
await controller.callInteraction('CreatePost', {
  user: currentUser,
  payload: {
    title: '标题',
    content: '内容',
    visibility: 'public'
  }
});

// 点赞内容
await controller.callInteraction('LikePost', {
  user: currentUser,
  payload: { postId: 'post-id' }
});
```

#### 数据查询
```javascript
// 获取用户资料
const userProfile = await controller.callInteraction('GetUserProfile', {
  user: currentUser,
  query: { userId: 'user-id' }
});

// 获取内容列表
const posts = await controller.callInteraction('GetPosts', {
  user: currentUser,
  query: { 
    limit: 20,
    offset: 0,
    filter: 'published'
  }
});
```

---

## 开发技术栈建议

### 前端框架
- **React 18** + **TypeScript**
- **Vite** 作为构建工具
- **React Router** 用于路由管理

### UI组件库
- **Ant Design** 或 **Material-UI** 作为基础组件
- **Tailwind CSS** 用于样式定制
- **Framer Motion** 用于动画效果

### 状态管理
- **Zustand** 用于全局状态
- **React Query** 用于服务端状态缓存
- **React Hook Form** 用于表单管理

### 工具库
- **date-fns** 用于时间处理
- **lodash** 用于工具函数
- **react-intersection-observer** 用于无限滚动

---

## 总结

这个社交内容网络应用的界面设计充分利用了 @interaqt/runtime 框架的响应式特性，实现了：

1. **数据驱动的界面更新**: 通过响应式计算自动更新统计数据和状态
2. **权限感知的交互设计**: 基于用户关系和权限动态显示操作选项
3. **状态管理的简化**: 利用框架的实体关系管理减少手动状态同步
4. **实时交互体验**: 通过声明式计算实现实时的社交互动反馈

界面设计遵循现代社交媒体的用户体验标准，同时充分发挥了响应式后端框架的优势，为用户提供流畅、实时的社交内容体验。