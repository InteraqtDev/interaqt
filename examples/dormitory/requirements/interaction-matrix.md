# 宿舍管理系统交互矩阵

## 交互概览

本矩阵定义了系统中所有角色与交互的对应关系，确保每个用户角色都有适当的操作权限，并且每个交互都有明确的访问控制和业务规则约束。

## 角色定义

| 角色 | 描述 | 权限级别 |
|------|------|----------|
| admin | 系统管理员 | 最高权限 |
| dormHead | 宿舍长 | 宿舍级管理权限 |
| student | 普通学生 | 基础权限 |

## 交互矩阵

### 1. 用户管理相关交互

#### CreateUser
| 角色 | 可访问 | 权限控制 | 业务规则 |
|------|--------|----------|----------|
| admin | ✓ | 仅管理员可创建 | 用户名、邮箱唯一 |
| dormHead | ✗ | - | - |
| student | ✗ | - | - |

**测试用例覆盖**: TC101 (权限测试)

#### AssignDormHead
| 角色 | 可访问 | 权限控制 | 业务规则 |
|------|--------|----------|----------|
| admin | ✓ | 仅管理员可指定 | 目标用户必须是学生角色 |
| dormHead | ✗ | - | - |
| student | ✗ | - | - |

**测试用例覆盖**: TC006 (核心逻辑)

### 2. 宿舍管理相关交互

#### CreateDormitory
| 角色 | 可访问 | 权限控制 | 业务规则 |
|------|--------|----------|----------|
| admin | ✓ | 仅管理员可创建 | 床位数量4-6 |
| dormHead | ✗ | - | - |
| student | ✗ | - | - |

**测试用例覆盖**: TC001 (核心逻辑), TC101 (权限), TC201 (业务规则)

#### GetDormitory
| 角色 | 可访问 | 权限控制 | 业务规则 |
|------|--------|----------|----------|
| admin | ✓ | 可查看所有宿舍 | - |
| dormHead | ✓ | 仅可查看自己管理的宿舍 | - |
| student | ✓ | 仅可查看自己所在的宿舍 | - |

#### ListDormitories
| 角色 | 可访问 | 权限控制 | 业务规则 |
|------|--------|----------|----------|
| admin | ✓ | 可查看所有宿舍列表 | - |
| dormHead | ✓ | 仅可查看自己管理的宿舍 | - |
| student | ✓ | 仅可查看自己所在的宿舍 | - |

### 3. 分配管理相关交互

#### AssignUserToDormitory
| 角色 | 可访问 | 权限控制 | 业务规则 |
|------|--------|----------|----------|
| admin | ✓ | 仅管理员可分配 | 用户未分配、宿舍有空位 |
| dormHead | ✗ | - | - |
| student | ✗ | - | - |

**测试用例覆盖**: TC002 (核心逻辑), TC202 (用户已分配), TC203 (宿舍已满)

#### RemoveUserFromDormitory
| 角色 | 可访问 | 权限控制 | 业务规则 |
|------|--------|----------|----------|
| admin | ✓ | 仅管理员可移除 | 用户必须已分配 |
| dormHead | ✗ | - | - |
| student | ✗ | - | - |

### 4. 行为管理相关交互

#### CreateBehaviorRecord
| 角色 | 可访问 | 权限控制 | 业务规则 |
|------|--------|----------|----------|
| admin | ✓ | 管理员可为任何用户记录 | 扣分原因不能为空 |
| dormHead | ✓ | 仅可为本宿舍成员记录 | 只能记录本宿舍用户 |
| student | ✗ | - | - |

**测试用例覆盖**: TC003 (核心逻辑), TC102 (权限)

#### GetBehaviorRecords
| 角色 | 可访问 | 权限控制 | 业务规则 |
|------|--------|----------|----------|
| admin | ✓ | 可查看所有记录 | - |
| dormHead | ✓ | 仅可查看本宿舍记录 | - |
| student | ✓ | 仅可查看自己的记录 | - |

#### GetUserPoints
| 角色 | 可访问 | 权限控制 | 业务规则 |
|------|--------|----------|----------|
| admin | ✓ | 可查看任何用户积分 | - |
| dormHead | ✓ | 仅可查看本宿舍成员积分 | - |
| student | ✓ | 仅可查看自己积分 | - |

### 5. 踢出流程相关交互

#### RequestEviction
| 角色 | 可访问 | 权限控制 | 业务规则 |
|------|--------|----------|----------|
| admin | ✓ | 管理员可直接踢出 | 用户积分<60 |
| dormHead | ✓ | 仅可申请踢出本宿舍成员 | 必须是本宿舍用户且积分<60 |
| student | ✗ | - | - |

**测试用例覆盖**: TC004 (核心逻辑), TC204 (积分不足)

#### ApproveEviction
| 角色 | 可访问 | 权限控制 | 业务规则 |
|------|--------|----------|----------|
| admin | ✓ | 仅管理员可审批 | 申请必须处于pending状态 |
| dormHead | ✗ | - | - |
| student | ✗ | - | - |

**测试用例覆盖**: TC005 (核心逻辑), TC103 (权限), TC205 (重复审批)

#### GetEvictionRequests
| 角色 | 可访问 | 权限控制 | 业务规则 |
|------|--------|----------|----------|
| admin | ✓ | 可查看所有申请 | - |
| dormHead | ✓ | 仅可查看自己提交的申请 | - |
| student | ✗ | - | - |

### 6. 查询相关交互

#### GetDormitoryOccupancy
| 角色 | 可访问 | 权限控制 | 业务规则 |
|------|--------|----------|----------|
| admin | ✓ | 可查看任何宿舍 | - |
| dormHead | ✓ | 仅可查看自己管理的宿舍 | - |
| student | ✓ | 仅可查看自己所在宿舍 | - |

#### ListUsersInDormitory
| 角色 | 可访问 | 权限控制 | 业务规则 |
|------|--------|----------|----------|
| admin | ✓ | 可查看任何宿舍的用户列表 | - |
| dormHead | ✓ | 仅可查看自己宿舍的用户列表 | - |
| student | ✓ | 仅可查看自己宿舍的用户列表 | - |

## 交互状态流转

### 踢出申请状态流转
```
pending → approved
    ↓
  rejected
```

### 用户宿舍分配状态
```
unassigned → assigned
    ↓
  evicted
```

### 宿舍状态
```
active → inactive
```

## 权限设计原则

1. **最小权限原则**: 每个角色只能访问完成其工作所需的最小权限
2. **职责分离**: 管理员负责全局管理，宿舍长负责日常管理
3. **数据隔离**: 用户只能访问自己或所属宿舍的数据
4. **审计追踪**: 所有关键操作都有记录，可追溯

## 业务规则总结

1. **宿舍创建**: 床位数量必须在4-6之间
2. **用户分配**: 每个用户只能分配到一个宿舍的一个床位
3. **行为评分**: 扣分必须有明确原因
4. **踢出申请**: 用户积分低于60才能申请
5. **审批流程**: 踢出申请必须经过管理员审批
6. **状态管理**: 所有关键实体都有明确的状态管理

## 测试覆盖验证

- ✅ 所有交互都有对应的测试用例
- ✅ 权限控制都有专门的权限测试
- ✅ 业务规则都有边界条件测试
- ✅ 核心业务逻辑有完整的流程测试
- ✅ 错误场景有异常处理测试