# 宿舍管理系统详细需求分析

## 业务背景
需要开发一套宿舍管理系统，支持多角色用户管理宿舍资源、用户分配和行为管理。

## 数据实体分析

### 核心实体
1. **User (用户)**
   - 基本信息：姓名、邮箱、手机号
   - 角色：admin(管理员)、dormHead(宿舍长)、student(学生)
   - 状态：active(活跃)、suspended(暂停)、expelled(被踢出)

2. **Dormitory (宿舍)**
   - 基本信息：宿舍名称、编号
   - 容量：床位数量 (4-6个)
   - 状态：可用床位数、总床位数

3. **Bed (床位)**
   - 所属宿舍
   - 床位编号
   - 状态：available(可用)、occupied(已占用)、maintenance(维护中)

4. **UserBedAssignment (用户床位分配)**
   - 用户与床位的关联关系
   - 分配时间
   - 状态：active(活跃)、inactive(非活跃)

5. **BehaviorRecord (行为记录)**
   - 用户行为违规记录
   - 违规类型、描述、扣分数值
   - 记录时间、记录人

6. **ExpulsionRequest (踢出申请)**
   - 申请人（宿舍长）
   - 被申请人（学生）
   - 申请原因、时间
   - 审批状态：pending(待审批)、approved(已批准)、rejected(已拒绝)

## 关系分析

### 核心关系
1. **UserDormitoryHeadRelation**: User(dormHead) ↔ Dormitory (1:n)
   - 一个宿舍长可以管理一个宿舍
   - 一个宿舍有一个宿舍长

2. **DormitoryBedRelation**: Dormitory ↔ Bed (1:n)
   - 一个宿舍有多个床位
   - 一个床位属于一个宿舍

3. **UserBedAssignmentRelation**: User ↔ Bed (n:1 through UserBedAssignment)
   - 一个用户只能分配到一个床位
   - 一个床位只能分配给一个用户

4. **UserBehaviorRecordRelation**: User ↔ BehaviorRecord (1:n)
   - 一个用户可以有多个行为记录
   - 一个行为记录属于一个用户

5. **ExpulsionRequestRelation**: User(dormHead) → User(student) through ExpulsionRequest
   - 宿舍长对学生的踢出申请关系

## 用户操作分析

### 管理员 (Admin) 操作
1. **用户管理**
   - 创建用户账号
   - 指定宿舍长角色
   - 查看所有用户信息

2. **宿舍管理**
   - 创建宿舍（指定床位数4-6）
   - 分配用户到宿舍床位
   - 查看宿舍占用情况

3. **踢出申请审批**
   - 查看踢出申请
   - 批准/拒绝踢出申请
   - 执行踢出操作（移除用户床位分配）

### 宿舍长 (DormHead) 操作
1. **宿舍成员管理**
   - 查看本宿舍成员信息
   - 记录成员违规行为
   - 计算成员总扣分

2. **踢出申请**
   - 申请踢出违规严重的成员
   - 查看申请状态

### 学生 (Student) 操作
1. **个人信息**
   - 查看个人信息
   - 查看自己的行为记录和扣分
   - 查看宿舍信息

## 业务规则分析

### 分配规则
1. 每个用户只能分配到一个床位
2. 每个床位只能分配给一个用户
3. 宿舍床位数限制为4-6个
4. 每个宿舍只能有一个宿舍长

### 扣分规则
1. 违规行为扣分累计
2. 扣分达到一定阈值（如100分）后，宿舍长可申请踢出
3. 行为记录包含：违规类型、扣分数值、时间、记录人

### 踢出流程
1. 宿舍长发起踢出申请
2. 管理员审核申请
3. 批准后，用户状态变为expelled，床位分配被移除
4. 被踢出用户无法再次分配床位

## 权限控制分析

### 角色权限矩阵
- **Admin**: 全部操作权限
- **DormHead**: 限于管理所属宿舍的权限
- **Student**: 只读个人相关信息权限

### 数据访问控制
- 宿舍长只能访问自己管理的宿舍数据
- 学生只能访问自己的个人数据
- 管理员可以访问所有数据