# 宿舍管理系统详细需求分析

## 1. 业务背景
该系统是一个宿舍管理系统，用于管理学生宿舍的分配、管理和纪律维护。

## 2. 用户角色分析
- **管理员 (Admin)**: 具有最高权限，可以管理宿舍、用户分配、处理申请
- **宿舍长 (DormHead)**: 由管理员指定，负责宿舍内部管理和纪律维护
- **学生 (Student)**: 普通用户，被分配到宿舍床位

## 3. 数据实体分析

### 3.1 用户 (User)
- **属性**:
  - id: 用户唯一标识
  - name: 姓名
  - email: 邮箱
  - role: 角色 (admin/dormHead/student)
  - score: 纪律分数 (初始100分)
  - status: 状态 (active/expelled)

### 3.2 宿舍 (Dormitory)
- **属性**:
  - id: 宿舍唯一标识
  - name: 宿舍名称
  - capacity: 容量 (4-6个床位)
  - currentOccupancy: 当前入住人数
  - status: 状态 (active/inactive)

### 3.3 床位 (Bed)
- **属性**:
  - id: 床位唯一标识
  - number: 床位号 (1-6)
  - status: 状态 (available/occupied)

### 3.4 纪律记录 (DisciplineRecord)
- **属性**:
  - id: 记录唯一标识
  - reason: 扣分原因
  - points: 扣分数
  - createdAt: 创建时间
  - status: 状态 (active/cancelled)

### 3.5 踢出申请 (ExpelRequest)
- **属性**:
  - id: 申请唯一标识
  - reason: 申请理由
  - status: 状态 (pending/approved/rejected)
  - createdAt: 申请时间
  - reviewedAt: 审核时间

## 4. 关系分析

### 4.1 用户-宿舍关系 (UserDormitory)
- 每个用户最多属于一个宿舍
- 每个宿舍可以有多个用户 (不超过capacity)
- 关系属性: assignedAt (分配时间)

### 4.2 用户-床位关系 (UserBed)
- 每个用户最多占用一个床位
- 每个床位最多被一个用户占用
- 关系属性: assignedAt (分配时间)

### 4.3 宿舍-床位关系 (DormitoryBed)
- 每个宿舍有多个床位 (4-6个)
- 每个床位属于一个宿舍

### 4.4 宿舍-宿舍长关系 (DormitoryHead)
- 每个宿舍有一个宿舍长
- 每个宿舍长管理一个宿舍

### 4.5 用户-纪律记录关系 (UserDiscipline)
- 每个用户可以有多个纪律记录
- 每个纪律记录属于一个用户

### 4.6 用户-踢出申请关系
- **申请者关系 (ExpelRequestApplicant)**: 宿舍长发起申请
- **被申请者关系 (ExpelRequestTarget)**: 被申请踢出的学生

## 5. 业务流程分析

### 5.1 宿舍管理流程
1. 管理员创建宿舍
2. 系统自动创建对应数量的床位
3. 管理员指定宿舍长
4. 管理员分配学生到宿舍床位

### 5.2 纪律管理流程
1. 发生违纪行为
2. 宿舍长或管理员记录纪律扣分
3. 系统自动更新用户分数
4. 当分数低于阈值时，允许申请踢出

### 5.3 踢出流程
1. 宿舍长发起踢出申请
2. 管理员审核申请
3. 如果同意，用户状态变为expelled，释放床位

## 6. 业务规则分析

### 6.1 宿舍容量规则
- 每个宿舍必须有4-6个床位
- 实际入住人数不能超过容量

### 6.2 用户分配规则
- 每个用户只能被分配到一个宿舍的一个床位
- 用户状态必须为active才能被分配

### 6.3 纪律分数规则
- 用户初始分数为100分
- 分数低于60分时可以申请踢出
- 分数不能为负数

### 6.4 权限规则
- 只有管理员可以创建宿舍和分配用户
- 只有宿舍长可以对本宿舍学生进行纪律记录和踢出申请
- 只有管理员可以审核踢出申请

### 6.5 踢出申请规则
- 只有当目标用户分数低于60分时才能发起申请
- 每个用户同时只能有一个pending状态的申请
- 宿舍长不能申请踢出自己

## 7. 常见扣分规则
- 晚归: 扣5分
- 未清理卫生: 扣3分
- 大声喧哗: 扣2分
- 损坏公物: 扣10分
- 违规用电: 扣8分
- 其他违规行为: 扣1-15分

## 8. 系统约束
- 宿舍名称不能重复
- 用户邮箱不能重复
- 床位编号在同一宿舍内不能重复
- 删除宿舍前必须先清空所有学生
- 删除用户前必须先释放床位分配