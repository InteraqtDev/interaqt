# Computation Analysis

## Entity: User

### Entity-Level Analysis
- **Purpose**: System users with different roles (admin, dormHead, student)
- **Creation Source**: Created manually via storage (users exist before interactions)
- **Update Requirements**: role (via AssignDormHead/RemoveDormHead), status (via ProcessKickOutApplication)
- **Deletion Strategy**: Soft delete with status ('active' â†’ 'kickedOut')

### Property Analysis

#### Property: id
- **Type**: string
- **Purpose**: Unique identifier
- **Data Source**: System-generated
- **Update Frequency**: Never
- **Computation Decision**: None (system handles)
- **Reasoning**: IDs are auto-generated by the framework

#### Property: name
- **Type**: string
- **Purpose**: User's display name
- **Data Source**: Set during creation
- **Update Frequency**: Never
- **Computation Decision**: None
- **Reasoning**: Static property set at creation

#### Property: email
- **Type**: string
- **Purpose**: Unique identifier for login
- **Data Source**: Set during creation
- **Update Frequency**: Never
- **Computation Decision**: None
- **Reasoning**: Static property set at creation

#### Property: role
- **Type**: string
- **Purpose**: User role (admin/dormHead/student)
- **Data Source**: Set at creation, updated via interactions
- **Update Frequency**: Via AssignDormHead, RemoveDormHead
- **Computation Decision**: StateMachine
- **Reasoning**: Changes based on specific interactions, has defined states

#### Property: status
- **Type**: string
- **Purpose**: User status (active/kickedOut)
- **Data Source**: State transitions
- **Update Frequency**: Via ProcessKickOutApplication
- **Computation Decision**: StateMachine
- **Reasoning**: Has defined states with clear transitions

#### Property: totalDeductions (computed)
- **Type**: number
- **Purpose**: Sum of all point deductions
- **Data Source**: Sum from UserPointDeductionRelation
- **Update Frequency**: Automatic when deductions added
- **Computation Decision**: Summation
- **Reasoning**: Simple sum of related deduction points

#### Property: currentPoints (computed)
- **Type**: number
- **Purpose**: Current behavior points (100 - totalDeductions)
- **Data Source**: Calculation based on totalDeductions
- **Update Frequency**: When totalDeductions changes
- **Computation Decision**: computed function
- **Reasoning**: Simple calculation from current record's totalDeductions

#### Property: isDormHead (computed)
- **Type**: boolean
- **Purpose**: Whether user manages any dormitory
- **Data Source**: Check managedDormitories relation
- **Update Frequency**: When UserDormHeadRelation changes
- **Computation Decision**: Count with boolean conversion
- **Reasoning**: True if count of managedDormitories > 0

### Entity Computation Decision
- **Type**: None
- **Source**: N/A
- **Reasoning**: Users are created externally/manually, not via interactions

## Entity: Dormitory

### Entity-Level Analysis
- **Purpose**: Dormitory buildings/rooms
- **Creation Source**: CreateDormitory interaction
- **Update Requirements**: No property updates needed
- **Deletion Strategy**: None (dormitories are permanent)

### Property Analysis

#### Property: id
- **Type**: string
- **Purpose**: Unique identifier
- **Data Source**: System-generated
- **Update Frequency**: Never
- **Computation Decision**: None (system handles)
- **Reasoning**: IDs are auto-generated by the framework

#### Property: name
- **Type**: string
- **Purpose**: Dormitory name/number
- **Data Source**: CreateDormitory payload
- **Update Frequency**: Never
- **Computation Decision**: None
- **Reasoning**: Set once during creation

#### Property: capacity
- **Type**: number
- **Purpose**: Number of beds (4-6)
- **Data Source**: CreateDormitory payload
- **Update Frequency**: Never
- **Computation Decision**: None
- **Reasoning**: Set once during creation

#### Property: floor
- **Type**: number
- **Purpose**: Floor number
- **Data Source**: CreateDormitory payload
- **Update Frequency**: Never
- **Computation Decision**: None
- **Reasoning**: Set once during creation

#### Property: building
- **Type**: string
- **Purpose**: Building name
- **Data Source**: CreateDormitory payload
- **Update Frequency**: Never
- **Computation Decision**: None
- **Reasoning**: Set once during creation

#### Property: occupiedBeds (computed)
- **Type**: number
- **Purpose**: Count of occupied beds
- **Data Source**: Count beds where status='occupied'
- **Update Frequency**: When bed statuses change
- **Computation Decision**: Count with filter
- **Reasoning**: Count related beds with specific condition

#### Property: availableBeds (computed)
- **Type**: number
- **Purpose**: Number of available beds
- **Data Source**: capacity - occupiedBeds
- **Update Frequency**: When occupiedBeds changes
- **Computation Decision**: computed function
- **Reasoning**: Simple calculation from current record

#### Property: occupancyRate (computed)
- **Type**: number
- **Purpose**: Percentage of beds occupied
- **Data Source**: (occupiedBeds / capacity) * 100
- **Update Frequency**: When occupiedBeds changes
- **Computation Decision**: computed function
- **Reasoning**: Simple calculation from current record

### Entity Computation Decision
- **Type**: Transform
- **Source**: InteractionEventEntity
- **Reasoning**: Dormitories created via CreateDormitory interaction

## Entity: Bed

### Entity-Level Analysis
- **Purpose**: Individual bed assignments within a dormitory
- **Creation Source**: Automatically created when dormitory is created
- **Update Requirements**: status (available/occupied)
- **Deletion Strategy**: None (beds exist as long as dormitory exists)

### Property Analysis

#### Property: id
- **Type**: string
- **Purpose**: Unique identifier
- **Data Source**: System-generated
- **Update Frequency**: Never
- **Computation Decision**: None (system handles)
- **Reasoning**: IDs are auto-generated by the framework

#### Property: bedNumber
- **Type**: number
- **Purpose**: Bed number within dormitory (1 to capacity)
- **Data Source**: Set during creation
- **Update Frequency**: Never
- **Computation Decision**: None
- **Reasoning**: Set once during creation

#### Property: status
- **Type**: string
- **Purpose**: Bed availability (available/occupied)
- **Data Source**: State transitions
- **Update Frequency**: Via AssignUserToBed, RemoveUserFromBed, ProcessKickOutApplication
- **Computation Decision**: StateMachine
- **Reasoning**: Has defined states with clear transitions

### Entity Computation Decision
- **Type**: Transform
- **Source**: Dormitory (when dormitory created)
- **Reasoning**: Beds are created automatically when dormitory is created

## Entity: PointDeduction

### Entity-Level Analysis
- **Purpose**: Records of point deductions for user behaviors
- **Creation Source**: RecordPointDeduction interaction
- **Update Requirements**: None (immutable records)
- **Deletion Strategy**: None (audit trail must be maintained)

### Property Analysis

#### Property: id
- **Type**: string
- **Purpose**: Unique identifier
- **Data Source**: System-generated
- **Update Frequency**: Never
- **Computation Decision**: None (system handles)
- **Reasoning**: IDs are auto-generated by the framework

#### Property: reason
- **Type**: string
- **Purpose**: Description of violation
- **Data Source**: RecordPointDeduction payload
- **Update Frequency**: Never
- **Computation Decision**: None
- **Reasoning**: Set once during creation

#### Property: points
- **Type**: number
- **Purpose**: Points deducted
- **Data Source**: RecordPointDeduction payload
- **Update Frequency**: Never
- **Computation Decision**: None
- **Reasoning**: Set once during creation

#### Property: timestamp
- **Type**: number
- **Purpose**: When deduction occurred
- **Data Source**: Current time at creation
- **Update Frequency**: Never
- **Computation Decision**: defaultValue
- **Reasoning**: Set once with Date.now()

#### Property: recordedBy
- **Type**: string
- **Purpose**: ID of dorm head who recorded
- **Data Source**: User from interaction context
- **Update Frequency**: Never
- **Computation Decision**: None (set in Transform)
- **Reasoning**: Set once during creation from interaction user

### Entity Computation Decision
- **Type**: Transform
- **Source**: InteractionEventEntity
- **Reasoning**: Created via RecordPointDeduction interaction

## Entity: KickOutApplication

### Entity-Level Analysis
- **Purpose**: Applications from dormitory heads to kick out users
- **Creation Source**: SubmitKickOutApplication interaction
- **Update Requirements**: status, processedTime, processedBy
- **Deletion Strategy**: None (audit trail must be maintained)

### Property Analysis

#### Property: id
- **Type**: string
- **Purpose**: Unique identifier
- **Data Source**: System-generated
- **Update Frequency**: Never
- **Computation Decision**: None (system handles)
- **Reasoning**: IDs are auto-generated by the framework

#### Property: reason
- **Type**: string
- **Purpose**: Detailed reason for kick-out request
- **Data Source**: SubmitKickOutApplication payload
- **Update Frequency**: Never
- **Computation Decision**: None
- **Reasoning**: Set once during creation

#### Property: status
- **Type**: string
- **Purpose**: Application status (pending/approved/rejected)
- **Data Source**: State transitions
- **Update Frequency**: Via ProcessKickOutApplication
- **Computation Decision**: StateMachine
- **Reasoning**: Has defined states with clear transitions

#### Property: applicationTime
- **Type**: number
- **Purpose**: When application was submitted
- **Data Source**: Current time at creation
- **Update Frequency**: Never
- **Computation Decision**: defaultValue
- **Reasoning**: Set once with Date.now()

#### Property: processedTime
- **Type**: number
- **Purpose**: When application was processed
- **Data Source**: Set when processed
- **Update Frequency**: Via ProcessKickOutApplication
- **Computation Decision**: StateMachine with computeValue
- **Reasoning**: Set to current time when status changes

#### Property: processedBy
- **Type**: string
- **Purpose**: Admin who processed application
- **Data Source**: User from ProcessKickOutApplication
- **Update Frequency**: Via ProcessKickOutApplication
- **Computation Decision**: StateMachine with computeValue
- **Reasoning**: Set to admin user ID when processed

### Entity Computation Decision
- **Type**: Transform
- **Source**: InteractionEventEntity
- **Reasoning**: Created via SubmitKickOutApplication interaction

## Relation: UserDormHeadRelation

### Relation Analysis
- **Purpose**: Links dormitories to their assigned heads
- **Creation**: Via AssignDormHead interaction
- **Deletion Requirements**: Via RemoveDormHead interaction (can be deleted)
- **Update Requirements**: None
- **State Management**: Need deletion capability
- **Computation Decision**: StateMachine only (hard delete)
- **Reasoning**: Relations need both creation and deletion without audit trail

## Relation: UserBedRelation

### Relation Analysis
- **Purpose**: Tracks bed assignments
- **Creation**: Via AssignUserToBed interaction
- **Deletion Requirements**: Via RemoveUserFromBed or when user kicked out
- **Update Requirements**: assignedAt and assignedBy are set at creation
- **State Management**: Need deletion capability
- **Computation Decision**: StateMachine only (hard delete)
- **Reasoning**: Relations need deletion capability, no audit trail needed

## Relation: DormitoryBedRelation

### Relation Analysis
- **Purpose**: Links beds to their parent dormitory
- **Creation**: Automatic when beds are created with dormitory
- **Deletion Requirements**: Never deleted
- **Update Requirements**: None
- **State Management**: None needed
- **Computation Decision**: None
- **Reasoning**: Created automatically with bed creation, never changes

## Relation: UserPointDeductionRelation

### Relation Analysis
- **Purpose**: Tracks all point deductions for a user
- **Creation**: Automatic when PointDeduction created with user reference
- **Deletion Requirements**: Never deleted (audit trail)
- **Update Requirements**: None
- **State Management**: None needed
- **Computation Decision**: None
- **Reasoning**: Created automatically with deduction, never changes

## Relation: KickOutApplicationUserRelation

### Relation Analysis
- **Purpose**: Links kick-out applications to target users
- **Creation**: Automatic when KickOutApplication created with user reference
- **Deletion Requirements**: Never deleted (audit trail)
- **Update Requirements**: None
- **State Management**: None needed
- **Computation Decision**: None
- **Reasoning**: Created automatically with application, never changes

## Relation: KickOutApplicationApplicantRelation

### Relation Analysis
- **Purpose**: Links kick-out applications to applicant (dorm head)
- **Creation**: Automatic when KickOutApplication created with applicant reference
- **Deletion Requirements**: Never deleted (audit trail)
- **Update Requirements**: None
- **State Management**: None needed
- **Computation Decision**: None
- **Reasoning**: Created automatically with application, never changes

## Filtered Entities

### ActiveUser
- **Source Entity**: User
- **Filter**: status = 'active'
- **Purpose**: Query only active users

### AvailableBed
- **Source Entity**: Bed
- **Filter**: status = 'available'
- **Purpose**: Query only available beds

### PendingKickOutApplication
- **Source Entity**: KickOutApplication
- **Filter**: status = 'pending'
- **Purpose**: Query only pending applications

## Summary of Computation Decisions

### Entities with Transform:
1. **Dormitory** - Created via CreateDormitory interaction
2. **Bed** - Created when Dormitory is created
3. **PointDeduction** - Created via RecordPointDeduction interaction
4. **KickOutApplication** - Created via SubmitKickOutApplication interaction

### Properties with StateMachine:
1. **User.role** - Changes via AssignDormHead/RemoveDormHead
2. **User.status** - Changes via ProcessKickOutApplication
3. **Bed.status** - Changes via bed assignment/removal
4. **KickOutApplication.status** - Changes via ProcessKickOutApplication
5. **KickOutApplication.processedTime** - Set when processed (with computeValue)
6. **KickOutApplication.processedBy** - Set when processed (with computeValue)

### Properties with Aggregations:
1. **User.totalDeductions** - Summation of point deductions
2. **User.isDormHead** - Count of managed dormitories > 0
3. **Dormitory.occupiedBeds** - Count of beds where status='occupied'

### Properties with computed functions:
1. **User.currentPoints** - 100 - totalDeductions
2. **Dormitory.availableBeds** - capacity - occupiedBeds
3. **Dormitory.occupancyRate** - (occupiedBeds / capacity) * 100

### Relations with StateMachine:
1. **UserDormHeadRelation** - Needs creation and deletion
2. **UserBedRelation** - Needs creation and deletion

### Relations with no computation:
1. **DormitoryBedRelation** - Created with entities
2. **UserPointDeductionRelation** - Created with entities
3. **KickOutApplicationUserRelation** - Created with entities
4. **KickOutApplicationApplicantRelation** - Created with entities 