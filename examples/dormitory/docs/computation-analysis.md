# Computation Analysis

## Entity: User

### Entity-Level Analysis
- **Purpose**: System users with different roles (admin, dormHead, student)
- **Creation Source**: Could be created via registration or admin interface (not specified in requirements - will assume direct creation)
- **Update Requirements**: Role changes, status changes, violation score updates
- **Deletion Strategy**: Soft delete with status (kickedOut)

### Property Analysis

#### Property: id
- **Type**: string
- **Purpose**: Unique identifier
- **Data Source**: System-generated
- **Update Frequency**: Never
- **Computation Decision**: None (system handles)
- **Reasoning**: IDs are auto-generated by the framework

#### Property: name
- **Type**: string
- **Purpose**: User's display name
- **Data Source**: Set at creation
- **Update Frequency**: Rarely (if at all)
- **Computation Decision**: None
- **Reasoning**: Simple field without computation needs

#### Property: email
- **Type**: string
- **Purpose**: Unique identifier for login
- **Data Source**: Set at creation
- **Update Frequency**: Rarely
- **Computation Decision**: None
- **Reasoning**: Simple field without computation needs

#### Property: phone
- **Type**: string
- **Purpose**: Contact information
- **Data Source**: Set at creation
- **Update Frequency**: Occasionally via update
- **Computation Decision**: None
- **Reasoning**: Simple field without computation needs

#### Property: role
- **Type**: string
- **Purpose**: User role (admin/dormHead/student)
- **Data Source**: Set at creation, updated via AssignDormHead
- **Update Frequency**: When assigned as dorm head
- **Computation Decision**: StateMachine
- **Reasoning**: Changes state from student to dormHead via interaction
- **Dependencies**: AssignDormHead interaction
- **Calculation Method**: Transition from current role to 'dormHead' when AssignDormHead interaction occurs

#### Property: violationScore
- **Type**: number
- **Purpose**: Total accumulated violation points
- **Data Source**: Sum of all active violation records
- **Update Frequency**: When violations are recorded
- **Computation Decision**: Summation
- **Reasoning**: Sum of points from all active ViolationRecords
- **Dependencies**: UserViolationRelation, ViolationRecord entity (points property, status property)
- **Calculation Method**: Sum of ViolationRecord.points where status='active' for all related violations

#### Property: status
- **Type**: string
- **Purpose**: User account status (active/suspended/kickedOut)
- **Data Source**: State transitions
- **Update Frequency**: Via kickout approval
- **Computation Decision**: StateMachine
- **Reasoning**: Has defined states with transitions triggered by admin actions
- **Dependencies**: ApproveKickoutRequest interaction
- **Calculation Method**: State transitions: active→kickedOut when kickout request approved

### Entity Computation Decision
- **Type**: None
- **Reasoning**: Users are created directly, not via a specific interaction in the current requirements

## Entity: Dormitory

### Entity-Level Analysis
- **Purpose**: Physical dormitory buildings that house students
- **Creation Source**: CreateDormitory interaction
- **Update Requirements**: Occupancy count updates, status changes
- **Deletion Strategy**: Soft delete with status (inactive)

### Property Analysis

#### Property: id
- **Type**: string
- **Purpose**: Unique identifier
- **Data Source**: System-generated
- **Update Frequency**: Never
- **Computation Decision**: None (system handles)
- **Reasoning**: IDs are auto-generated by the framework

#### Property: name
- **Type**: string
- **Purpose**: Building name/number
- **Data Source**: CreateDormitory interaction payload
- **Update Frequency**: Never
- **Computation Decision**: None
- **Reasoning**: Set once at creation, doesn't change

#### Property: capacity
- **Type**: number
- **Purpose**: Total bed capacity (4-6)
- **Data Source**: CreateDormitory interaction payload
- **Update Frequency**: Never
- **Computation Decision**: None
- **Reasoning**: Set at creation, doesn't change

#### Property: occupancyCount
- **Type**: number
- **Purpose**: Current number of occupied beds
- **Data Source**: Count of occupied beds
- **Update Frequency**: When beds become occupied/vacant
- **Computation Decision**: Count
- **Reasoning**: Count of related beds where status='occupied'
- **Dependencies**: BedDormitoryRelation (direction: target), Bed entity (status property)
- **Calculation Method**: Count all related Bed entities where status='occupied'

#### Property: status
- **Type**: string
- **Purpose**: Dormitory operational status
- **Data Source**: Computed based on occupancy
- **Update Frequency**: When occupancy changes
- **Computation Decision**: computed
- **Reasoning**: Derived from current record's occupancy vs capacity
- **Dependencies**: Current dormitory's occupancyCount and capacity
- **Calculation Method**: If occupancyCount >= capacity then 'full', else 'active'

### Entity Computation Decision
- **Type**: Transform
- **Source**: InteractionEventEntity
- **Reasoning**: Dormitories are created via CreateDormitory interaction
- **Dependencies**: CreateDormitory interaction event, payload data
- **Calculation Method**: When CreateDormitory interaction fires, create new Dormitory entity with name and capacity from payload

## Entity: Bed

### Entity-Level Analysis
- **Purpose**: Individual bed units within dormitories
- **Creation Source**: Created automatically when dormitory is created
- **Update Requirements**: Status changes (vacant/occupied)
- **Deletion Strategy**: Never deleted (exists as long as dormitory exists)

### Property Analysis

#### Property: id
- **Type**: string
- **Purpose**: Unique identifier
- **Data Source**: System-generated
- **Update Frequency**: Never
- **Computation Decision**: None (system handles)
- **Reasoning**: IDs are auto-generated by the framework

#### Property: number
- **Type**: string
- **Purpose**: Bed identifier within dormitory
- **Data Source**: Generated during dormitory creation
- **Update Frequency**: Never
- **Computation Decision**: None
- **Reasoning**: Set at creation, doesn't change

#### Property: status
- **Type**: string
- **Purpose**: Bed availability (vacant/occupied)
- **Data Source**: State transitions based on assignments
- **Update Frequency**: When user assigned/removed
- **Computation Decision**: StateMachine
- **Reasoning**: Changes between vacant and occupied states
- **Dependencies**: AssignUserToBed, RemoveUserFromBed, TransferUser, ApproveKickoutRequest interactions
- **Calculation Method**: vacant→occupied on assignment, occupied→vacant on removal/kickout

### Entity Computation Decision
- **Type**: Transform
- **Source**: Dormitory entity
- **Reasoning**: Beds are created when dormitory is created
- **Dependencies**: Dormitory creation, capacity value
- **Calculation Method**: When Dormitory is created, generate N Bed entities where N = dormitory.capacity

## Entity: ViolationRule

### Entity-Level Analysis
- **Purpose**: Predefined rules with associated penalty points
- **Creation Source**: CreateViolationRule interaction
- **Update Requirements**: None (rules are immutable once created)
- **Deletion Strategy**: Never deleted (maintain historical accuracy)

### Property Analysis

#### Property: id
- **Type**: string
- **Purpose**: Unique identifier
- **Data Source**: System-generated
- **Update Frequency**: Never
- **Computation Decision**: None (system handles)
- **Reasoning**: IDs are auto-generated by the framework

#### Property: name
- **Type**: string
- **Purpose**: Rule name
- **Data Source**: CreateViolationRule payload
- **Update Frequency**: Never
- **Computation Decision**: None
- **Reasoning**: Set at creation, immutable

#### Property: description
- **Type**: string
- **Purpose**: Detailed description
- **Data Source**: CreateViolationRule payload
- **Update Frequency**: Never
- **Computation Decision**: None
- **Reasoning**: Set at creation, immutable

#### Property: points
- **Type**: number
- **Purpose**: Penalty points
- **Data Source**: CreateViolationRule payload
- **Update Frequency**: Never
- **Computation Decision**: None
- **Reasoning**: Set at creation, immutable

#### Property: category
- **Type**: string
- **Purpose**: Rule category (hygiene/noise/safety/discipline)
- **Data Source**: CreateViolationRule payload
- **Update Frequency**: Never
- **Computation Decision**: None
- **Reasoning**: Set at creation, immutable

### Entity Computation Decision
- **Type**: Transform
- **Source**: InteractionEventEntity
- **Reasoning**: Rules are created via CreateViolationRule interaction
- **Dependencies**: CreateViolationRule interaction event, payload data
- **Calculation Method**: When CreateViolationRule fires, create new ViolationRule with all fields from payload

## Entity: ViolationRecord

### Entity-Level Analysis
- **Purpose**: Actual violations recorded against users
- **Creation Source**: RecordViolation interaction
- **Update Requirements**: Status changes (active/appealed/revoked)
- **Deletion Strategy**: Soft delete with status (revoked)

### Property Analysis

#### Property: id
- **Type**: string
- **Purpose**: Unique identifier
- **Data Source**: System-generated
- **Update Frequency**: Never
- **Computation Decision**: None (system handles)
- **Reasoning**: IDs are auto-generated by the framework

#### Property: description
- **Type**: string
- **Purpose**: Specific incident description
- **Data Source**: RecordViolation payload
- **Update Frequency**: Never
- **Computation Decision**: None
- **Reasoning**: Set at creation, doesn't change

#### Property: points
- **Type**: number
- **Purpose**: Points deducted
- **Data Source**: From associated ViolationRule
- **Update Frequency**: Never
- **Computation Decision**: None
- **Reasoning**: Set at creation from rule, doesn't change

#### Property: recordedAt
- **Type**: number
- **Purpose**: Timestamp
- **Data Source**: System time at creation
- **Update Frequency**: Never
- **Computation Decision**: None
- **Reasoning**: Set once at creation using defaultValue

#### Property: status
- **Type**: string
- **Purpose**: Record status (active/appealed/revoked)
- **Data Source**: Set at creation, may change later
- **Update Frequency**: Could change if appeal system added
- **Computation Decision**: None (defaultValue)
- **Reasoning**: Currently only set to 'active' at creation, no transitions defined

### Entity Computation Decision
- **Type**: Transform
- **Source**: InteractionEventEntity
- **Reasoning**: Records are created via RecordViolation interaction
- **Dependencies**: RecordViolation interaction event, ViolationRule reference, User reference
- **Calculation Method**: When RecordViolation fires, create ViolationRecord linking user, rule, and recording dormHead

## Entity: KickoutRequest

### Entity-Level Analysis
- **Purpose**: Formal requests from dorm heads to remove residents
- **Creation Source**: RequestKickout interaction
- **Update Requirements**: Status changes, admin comments
- **Deletion Strategy**: Never deleted (maintain audit trail)

### Property Analysis

#### Property: id
- **Type**: string
- **Purpose**: Unique identifier
- **Data Source**: System-generated
- **Update Frequency**: Never
- **Computation Decision**: None (system handles)
- **Reasoning**: IDs are auto-generated by the framework

#### Property: reason
- **Type**: string
- **Purpose**: Justification for removal
- **Data Source**: RequestKickout payload
- **Update Frequency**: Never
- **Computation Decision**: None
- **Reasoning**: Set at creation, doesn't change

#### Property: requestDate
- **Type**: number
- **Purpose**: Timestamp
- **Data Source**: System time at creation
- **Update Frequency**: Never
- **Computation Decision**: None
- **Reasoning**: Set once at creation using defaultValue

#### Property: status
- **Type**: string
- **Purpose**: Request status (pending/approved/rejected)
- **Data Source**: State transitions
- **Update Frequency**: Via admin actions
- **Computation Decision**: StateMachine
- **Reasoning**: Has defined states with clear transitions
- **Dependencies**: ApproveKickoutRequest, RejectKickoutRequest interactions
- **Calculation Method**: pending→approved or pending→rejected based on admin decision

#### Property: adminComments
- **Type**: string
- **Purpose**: Admin's decision notes
- **Data Source**: Admin interaction payload
- **Update Frequency**: When approved/rejected
- **Computation Decision**: StateMachine with computeValue
- **Reasoning**: Set when status changes to approved/rejected
- **Dependencies**: ApproveKickoutRequest, RejectKickoutRequest interactions
- **Calculation Method**: Set to payload.comments when status transitions

### Entity Computation Decision
- **Type**: Transform
- **Source**: InteractionEventEntity
- **Reasoning**: Requests are created via RequestKickout interaction
- **Dependencies**: RequestKickout interaction event, user context, target user reference
- **Calculation Method**: When RequestKickout fires, create KickoutRequest with initiator, target, and reason

## Relation: BedDormitoryRelation

### Relation Analysis
- **Purpose**: Links beds to their parent dormitory
- **Creation**: Created automatically when bed is created
- **Deletion Requirements**: Never deleted (beds exist as long as dormitory exists)
- **Update Requirements**: No property updates needed
- **State Management**: No status needed
- **Computation Decision**: None
- **Reasoning**: Created as part of Bed creation via entity reference
- **Dependencies**: N/A (created with Bed entity)
- **Calculation Method**: N/A (automatic with Bed creation)

## Relation: UserBedRelation

### Relation Analysis
- **Purpose**: Assigns users to specific beds
- **Creation**: Via AssignUserToBed interaction
- **Deletion Requirements**: Hard delete when user removed, transferred, or kicked out
- **Update Requirements**: No property updates after creation
- **State Management**: No status needed (existence = assignment)
- **Computation Decision**: StateMachine only
- **Reasoning**: Need both creation and deletion capability, no audit trail needed
- **Dependencies**: AssignUserToBed, RemoveUserFromBed, TransferUser, ApproveKickoutRequest interactions
- **Calculation Method**: Create on assignment, delete on removal/transfer/kickout

## Relation: DormitoryDormHeadRelation

### Relation Analysis
- **Purpose**: Designates management responsibility
- **Creation**: Via AssignDormHead interaction
- **Deletion Requirements**: Could be deleted when dorm head role removed (not in current requirements)
- **Update Requirements**: No property updates
- **State Management**: No status needed
- **Computation Decision**: Transform
- **Reasoning**: Currently only creation is needed, no removal interaction defined
- **Dependencies**: AssignDormHead interaction, existing User and Dormitory
- **Calculation Method**: Create relation when AssignDormHead interaction fires

## Relation: UserViolationRelation

### Relation Analysis
- **Purpose**: Links violation records to users
- **Creation**: Created automatically when ViolationRecord is created
- **Deletion Requirements**: Never deleted (maintain violation history)
- **Update Requirements**: No property updates
- **State Management**: No status needed
- **Computation Decision**: None
- **Reasoning**: Created as part of ViolationRecord creation via entity reference
- **Dependencies**: N/A (created with ViolationRecord)
- **Calculation Method**: N/A (automatic with ViolationRecord creation)

## Relation: ViolationRuleRecordRelation

### Relation Analysis
- **Purpose**: Links violation records to their rules
- **Creation**: Created automatically when ViolationRecord is created
- **Deletion Requirements**: Never deleted
- **Update Requirements**: No property updates
- **State Management**: No status needed
- **Computation Decision**: None
- **Reasoning**: Created as part of ViolationRecord creation via entity reference
- **Dependencies**: N/A (created with ViolationRecord)
- **Calculation Method**: N/A (automatic with ViolationRecord creation)

## Relation: RecorderViolationRelation

### Relation Analysis
- **Purpose**: Tracks who recorded each violation
- **Creation**: Created automatically when ViolationRecord is created
- **Deletion Requirements**: Never deleted (audit trail)
- **Update Requirements**: No property updates
- **State Management**: No status needed
- **Computation Decision**: None
- **Reasoning**: Created as part of ViolationRecord creation via entity reference
- **Dependencies**: N/A (created with ViolationRecord)
- **Calculation Method**: N/A (automatic with ViolationRecord creation)

## Relation: KickoutRequestUserRelation

### Relation Analysis
- **Purpose**: Links kickout requests to target users
- **Creation**: Created automatically when KickoutRequest is created
- **Deletion Requirements**: Never deleted (audit trail)
- **Update Requirements**: No property updates
- **State Management**: No status needed
- **Computation Decision**: None
- **Reasoning**: Created as part of KickoutRequest creation via entity reference
- **Dependencies**: N/A (created with KickoutRequest)
- **Calculation Method**: N/A (automatic with KickoutRequest creation)

## Relation: KickoutRequestInitiatorRelation

### Relation Analysis
- **Purpose**: Tracks who initiated each request
- **Creation**: Created automatically when KickoutRequest is created
- **Deletion Requirements**: Never deleted (audit trail)
- **Update Requirements**: No property updates
- **State Management**: No status needed
- **Computation Decision**: None
- **Reasoning**: Created as part of KickoutRequest creation via entity reference
- **Dependencies**: N/A (created with KickoutRequest)
- **Calculation Method**: N/A (automatic with KickoutRequest creation)

## Relation: KickoutRequestDormitoryRelation

### Relation Analysis
- **Purpose**: Links requests to the relevant dormitory
- **Creation**: Created when KickoutRequest is created (derived from target user's dormitory)
- **Deletion Requirements**: Never deleted (audit trail)
- **Update Requirements**: No property updates
- **State Management**: No status needed
- **Computation Decision**: None
- **Reasoning**: Created as part of KickoutRequest creation
- **Dependencies**: N/A (created with KickoutRequest)
- **Calculation Method**: N/A (automatic with KickoutRequest creation)