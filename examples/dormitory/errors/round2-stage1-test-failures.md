# Round 2: Stage 1 Test Failures

## Problem Summary
Multiple test failures in Stage 1 core logic tests due to various issues with entity creation, relation names, and StateMachine computations.

## Test Results
- **Total**: 16 tests
- **Failed**: 12 tests
- **Passed**: 4 tests (only filtered entity tests passed)

## Error Analysis

### 1. Create Dormitory Test Failure
**Error**: `expected undefined to be defined`
**Issue**: Dormitory creation through interaction is not working properly
**Likely Cause**: Transform computation in Dormitory entity may not be creating records correctly

### 2. AssignDormHead Test Failure
**Error**: `Cannot read properties of undefined (reading 'sourceRecordName')`
**Issue**: StateMachine transfer is failing during role change
**Likely Cause**: StateMachine computeTarget function may be returning undefined

### 3. Assign User to Dormitory Test Failure
**Error**: `Cannot read properties of undefined (reading 'id')`
**Issue**: Entity creation or relation creation is failing
**Likely Cause**: Dormitory or bed creation through interaction is not working

### 4. Score/Kick Request Test Failures
**Error**: `expected undefined to be defined`
**Issue**: Entity creation through Transform computations is not working
**Likely Cause**: Transform callbacks are not returning proper data structures

### 5. Process Kick Request Test Failures
**Error**: `InteractionExecutionError: Failed to run computation for dirty record`
**Root Cause**: StateMachine computation failing with `Cannot read properties of undefined (reading 'status')`
**Issue**: KickRequest entity creation is not working, so ProcessKickRequest cannot find the target entity

### 6. Remove Operations Test Failures
**Error**: `entity DormitoryHead not found`, `entity UserDormitory not found`
**Issue**: Relation names are incorrect
**Root Cause**: The relation names in the backend might not match what's expected

### 7. Score Rule Tests
**Error**: Various creation and deactivation failures
**Issue**: Transform computation and StateMachine transfers not working

## Root Cause Analysis

### Primary Issue: Transform Computations Not Creating Entities
Looking at the errors, it appears that Transform computations in entities are not creating records when interactions are called. This suggests:

1. **Transform callback return values**: May not be returning the correct data structure
2. **Interaction Event Processing**: Transform computations may not be triggered by interactions
3. **Entity Creation Flow**: The interaction → Transform → entity creation flow is broken

### Secondary Issue: StateMachine ComputeTarget Functions
StateMachine transfers are failing because they can't find target entities that should have been created by Transform computations.

### Tertiary Issue: Relation Name Mismatches
Some relation names in tests don't match the actual relation names defined in the backend.

## Next Steps

### 1. Fix Transform Computations
- Review Transform callback functions in all entities
- Ensure they return proper data structures
- Check that they're triggered by the correct interactions

### 2. Fix Relation Names
- Verify actual relation names generated by the system
- Update test code to use correct relation names

### 3. Fix StateMachine Issues
- Review computeTarget functions in StateMachine transfers
- Ensure they can handle cases where target entities might not exist yet

### 4. Simplify Test Setup
- Consider using direct entity creation for test setup instead of relying on interactions
- This will help isolate interaction testing from setup issues

## Impact
This affects the entire Stage 1 implementation verification. Need to fix these fundamental issues before proceeding to Stage 2 (permissions and business rules).